<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>QR Thanh To√°n - Karaoke RITA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 20px;
      color: #fff;
    }
    h2, h3 { margin: 5px 0; }
    .address { margin-bottom: 15px; font-size: 14px; }
    #qrImage {
      margin: 20px auto;
      width: 280px;
      height: 280px;
      background: #fff;
      padding: 10px;
      border-radius: 12px;
    }
    #amount {
      font-size: 18px;
      padding: 6px 10px;
      text-align: center;
      width: 220px;
      border-radius: 6px;
      border: none;
      margin-top: 10px;
    }
    #reader {
      width: 300px;
      margin: 15px auto;
      display: none;
    }
    .info p { margin: 3px 0; }
    button {
      padding: 8px 14px;
      margin-top: 10px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #28a745;
      color: white;
    }
  </style>
</head>
<body>
  <h2>QU√âT M√É ƒê·ªÇ THANH TO√ÅN</h2>
  <h3>KARAOKE RITA</h3>
  <div class="address">8 L√Ω Th∆∞·ªùng Ki·ªát, ƒê·ª©c Tr·ªçng</div>

  <input type="text" id="amount" placeholder="Nh·∫≠p s·ªë ti·ªÅn (VD: 150.000)" oninput="formatAndUpdateQR(this)">
  <div id="amountText"></div>

  <img id="qrImage" src="" alt="QR Thanh to√°n">
  
  <button onclick="startScan()">üì∑ Qu√©t m√£</button>
  <div id="reader"></div>

  <div class="info">
    <p><span>Ng√¢n h√†ng:</span> Vietcombank (VCB)</p>
    <p><span>S·ªë t√†i kho·∫£n:</span> 9917.523.946</p>
    <p><span>T√™n ng∆∞·ªùi nh·∫≠n:</span> HUYNH PHUONG TRANG</p>
    <p><span>................</span></p>
    <p><span>XIN C√ÅM ∆†N QU√ù KH√ÅCH ƒê√É S·ª¨ D·ª§NG D·ªäCH V·ª§ T·∫†I RITA</span></p>
  </div>

  <script>
    function formatNumber(n) {
      return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    function formatAndUpdateQR(input) {
      let raw = input.value.replace(/\D/g, "");
      input.value = formatNumber(input.value);
      updateQR(raw);
    }

    function updateQR(raw) {
      if (!raw) {
        document.getElementById("qrImage").src = "";
        document.getElementById("amountText").textContent = "";
        return;
      }
      const url = `https://img.vietqr.io/image/VCB-9917523946-qr_only.png?amount=${raw}&addInfo=Thank you&accountName=HUYNH+PHUONG+TRANG`;
      document.getElementById("qrImage").src = url;
      document.getElementById("amountText").textContent = toVietnameseText(raw) + " ƒë·ªìng";
    }

    // s·ªë th√†nh ch·ªØ
    function toVietnameseText(number) {
      const chuSo = ["kh√¥ng","m·ªôt","hai","ba","b·ªën","nƒÉm","s√°u","b·∫£y","t√°m","ch√≠n"];
      function docSo3ChuSo(baso) {
        let tram = parseInt(baso/100);
        let chuc = parseInt((baso%100)/10);
        let donvi = baso%10;
        let ketQua = "";
        if(tram!==0){ ketQua += chuSo[tram]+" trƒÉm "; if(chuc===0 && donvi!==0) ketQua+="linh "; }
        if(chuc!==0 && chuc!==1){ ketQua += chuSo[chuc]+" m∆∞∆°i "; if(chuc===0 && donvi!==0) ketQua+="linh "; }
        if(chuc===1) ketQua+="m∆∞·ªùi ";
        switch(donvi){
          case 1: ketQua+=(chuc!==0&&chuc!==1)?"m·ªët ":"m·ªôt "; break;
          case 5: ketQua+=(chuc!==0)?"lƒÉm ":"nƒÉm "; break;
          case 0: break;
          default: ketQua+=chuSo[donvi]+" ";
        }
        return ketQua;
      }
      let viTri = ["","ngh√¨n","tri·ªáu","t·ª∑"];
      let str="";
      let i=0;
      while(number>0){
        let baso = number%1000;
        if(baso!==0) str = docSo3ChuSo(baso)+viTri[i]+" "+str;
        number = parseInt(number/1000);
        i++;
      }
      return str.trim();
    }

    let scanner = null;

    async function startScan() {
      const reader = document.getElementById("reader");
      reader.style.display = "block";
      if (!scanner) scanner = new Html5Qrcode("reader");
      try {
        const devices = await Html5Qrcode.getCameras();
        let cameraId = devices[0].id;
        for (let d of devices) {
          if (/wide|ultra/i.test(d.label)) { cameraId = d.id; break; }
        }
        scanner.start(
          cameraId,
          { fps: 10, qrbox: 250 },
          qrCodeMessage => {
            console.log("Scanned:", qrCodeMessage);
            let amount = qrCodeMessage.replace(/\D/g, "");
            if (amount) {
              document.getElementById("amount").value = formatNumber(amount);
              updateQR(amount);
            }
            stopScan();
          },
          () => {}
        );
      } catch (err) {
        console.error("L·ªói camera:", err);
        alert("Kh√¥ng m·ªü ƒë∆∞·ª£c camera!");
      }
    }

    function stopScan() {
      if (scanner) {
        scanner.stop().then(() => {
          document.getElementById("reader").style.display = "none";
        }).catch(err => console.error("D·ª´ng camera l·ªói:", err));
      }
    }
  </script>
</body>
</html>
