<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Thanh Toán</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      text-align: center;
      color: #333;
    }
    .container {
      background: rgba(255,255,255,0.92);
      max-width: 500px;
      margin: 20px auto;
      padding: 20px;
      border-radius: 12px;
    }
    h2 { color: #0a53be; margin: 5px 0; }
    h3 { color: #2e7d32; margin: 5px 0; }
    .address { margin-bottom: 20px; color: #555; }
    input {
      width: 80%; padding: 10px; margin: 10px auto;
      border: 1px solid #ccc; border-radius: 6px;
      text-align: right; font-size: 16px;
    }
    #qr-reader { width: 100%; margin-top: 15px; }
    img {
      margin-top: 15px; padding: 10px; border: 1px solid #ccc;
      background: #fff; border-radius: 8px; max-width: 90%;
    }
    .info { text-align: left; margin-top: 15px; font-size: 15px; }
    .info span { font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h2>QUÉT MÃ ĐỂ THANH TOÁN</h2>
    <h3>KARAOKE RITA</h3>
    <div class="address">8 Lý Thường Kiệt, Đức Trọng</div>

    <input type="text" id="amount" placeholder="Nhập số tiền (VD: 150.000)" oninput="formatAndUpdateQR(this)">
    <div id="amountText"></div>

    <img id="qrImage" src="" alt="QR thanh toán">

    <div id="qr-reader"></div>

    <div class="info">
      <p><span>Ngân hàng:</span> Vietcombank (VCB)</p>
      <p><span>Số tài khoản:</span> 9917.523.946</p>
      <p><span>Tên người nhận:</span> HUYNH PHUONG TRANG</p>
      <p><span>................</span></p>
      <p><span>XIN CÁM ƠN QUÝ KHÁCH ĐÃ SỬ DỤNG DỊCH VỤ TẠI RITA</span></p>
    </div>
  </div>

<script>
function formatAndUpdateQR(input) {
  let raw = input.value.replace(/[^\d]/g, "");
  if (!raw) {
    document.getElementById("qrImage").src = "";
    document.getElementById("amountText").textContent = "";
    return;
  }
  input.value = Number(raw).toLocaleString("vi-VN");
  const url = `https://img.vietqr.io/image/VCB-9917523946-qr_only.png?amount=${raw}&addInfo=Thank+you&accountName=HUYNH+PHUONG+TRANG`;
  document.getElementById("qrImage").src = url;
  document.getElementById("amountText").textContent = toVietnameseText(raw) + " đồng";
}
function toVietnameseText(number) {
  const n = parseInt(number, 10);
  if (isNaN(n)) return "";
  const ChuSo = ["Không","Một","Hai","Ba","Bốn","Năm","Sáu","Bảy","Tám","Chín"];
  const Tien = ["","nghìn","triệu","tỷ"];
  function DocSo3ChuSo(baso) {
    let tram=Math.floor(baso/100), chuc=Math.floor((baso%100)/10), donvi=baso%10;
    let str="";
    if(tram>0){str+=ChuSo[tram]+" trăm";if(chuc===0&&donvi>0)str+=" linh";}
    if(chuc>1){str+=" "+ChuSo[chuc]+" mươi";if(donvi===1)str+=" mốt";else if(donvi===5)str+=" lăm";else if(donvi>0)str+=" "+ChuSo[donvi];}
    else if(chuc===1){str+=" mười";if(donvi===1)str+=" một";else if(donvi===5)str+=" lăm";else if(donvi>0)str+=" "+ChuSo[donvi];}
    else if(donvi>0){str+=" "+ChuSo[donvi];}
    return str.trim();
  }
  let result="",i=0,num=n;
  while(num>0){let phan=num%1000;if(phan>0){result=DocSo3ChuSo(phan)+" "+Tien[i]+" "+result;}num=Math.floor(num/1000);i++;}
  return result.trim().replace(/\s+/g," ");
}

// Mở camera sau (góc rộng) ngay khi load
window.addEventListener("load", () => {
  const html5QrCode = new Html5Qrcode("qr-reader");
  Html5Qrcode.getCameras().then(devices => {
    if (devices && devices.length) {
      // chọn camera sau nếu có
      let cameraId = devices.find(d => d.label.toLowerCase().includes("back"))?.id || devices[0].id;
      html5QrCode.start(
        cameraId,
        { fps: 10, qrbox: 250 },
        qrCodeMessage => {
          // ví dụ: lấy số tiền từ nội dung QR nếu chứa ?amount=...
          let match = qrCodeMessage.match(/amount=(\d+)/);
          if (match) {
            document.getElementById("amount").value = Number(match[1]).toLocaleString("vi-VN");
            formatAndUpdateQR(document.getElementById("amount"));
          }
        },
        errorMessage => {}
      );
    }
  }).catch(err => console.log(err));
});
</script>
</body>
</html>
