<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Thu ngân Karaoke</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background: #eee; }
    button { padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; }
    .open-btn { background: #007bff; color: #fff; }
    .paid-btn { background: #28a745; color: #fff; }
    .update-btn { background: #ffc107; color: #000; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
  </style>
</head>
<body>
  <h1>Thu ngân Karaoke</h1>
  <table id="roomTable">
    <thead>
      <tr>
        <th>Phòng</th>
        <th>Số tiền</th>
        <th>Trạng thái</th>
        <th>Giờ thanh toán</th>
        <th>Thao tác</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwur_6_mUlTTjYb9SWu6ZlEM_XeanC0UDUZG_QBjy4RrNKpywmaMjLOSMTatXBe2Tmt/exec";

async function loadRooms() {
  const res = await fetch(API_URL);
  const rooms = await res.json();

  const tbody = document.querySelector("#roomTable tbody");
  tbody.innerHTML = "";

  rooms.forEach(room => {
    const name = room.name;
    const amount = room.amount || 0;
    const status = room.status || "Đã thanh toán";
    const refTime = room.refTime || "";

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${name}</td>
      <td>${amount}</td>
      <td>${status}</td>
      <td>${refTime}</td>
      <td>
        <button class="open-btn" id="open-${name}" onclick="openRoom('${name}')" ${status === 'Chưa thanh toán' ? 'disabled' : ''}>Mở phòng</button>
        <button class="paid-btn" id="paid-${name}" onclick="markPaid('${name}')" ${status === 'Chưa thanh toán' ? '' : 'disabled'}>Đã thanh toán</button>
        <button class="update-btn" onclick="updateRoom('${name}')">Cập nhật</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

async function openRoom(name) {
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "openRoom", name })
  });
  loadRooms();
}

async function markPaid(name) {
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "markPaid", name })
  });
  loadRooms();
}

async function updateRoom(name) {
  const amount = prompt("Nhập số tiền mới:");
  if (amount !== null) {
    await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ action: "updateRoom", name, amount })
    });
    loadRooms();
  }
}

loadRooms();
</script>
</body>
</html>
