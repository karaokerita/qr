<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Thu Ngân Karaoke</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      padding: 20px;
    }
    h2 { text-align: center; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    input[type="number"] {
      width: 100px;
      padding: 4px;
    }
    button {
      padding: 5px 10px;
      margin: 2px;
      cursor: pointer;
    }
    .paid {
      background-color: #d4edda;
      color: #155724;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Quản lý thanh toán - Thu Ngân</h2>

  <table>
    <thead>
      <tr>
        <th>Phòng</th>
        <th>Số tiền</th>
        <th>Trạng thái</th>
        <th>Thao tác</th>
      </tr>
    </thead>
    <tbody id="roomTable"></tbody>
  </table>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxX0zz9Pb2etylSmxeqXbxvczl16kfyX8AVC2hKSECfnDXngysaoTxJRGjHpEWhjLHH/exec";

    // Lấy danh sách phòng từ Sheet
    async function loadRooms() {
      const res = await fetch(API_URL + "?action=getRooms");
      const data = await res.json();

      const tbody = document.getElementById("roomTable");
      tbody.innerHTML = "";

      data.forEach((room, index) => {
        const tr = document.createElement("tr");

        // tên phòng
        const tdName = document.createElement("td");
        tdName.textContent = room.name;
        tr.appendChild(tdName);

        // số tiền
        const tdAmount = document.createElement("td");
        const input = document.createElement("input");
        input.type = "number";
        input.value = room.amount || "";
        input.onchange = () => updateAmount(room.name, input.value);
        tdAmount.appendChild(input);
        tr.appendChild(tdAmount);

        // trạng thái
        const tdStatus = document.createElement("td");
        tdStatus.textContent = room.status || "Chưa thanh toán";
        if (room.status === "Đã thanh toán") {
          tdStatus.classList.add("paid");
        }
        tr.appendChild(tdStatus);

        // thao tác
        const tdAction = document.createElement("td");

        const btnSave = document.createElement("button");
        btnSave.textContent = "Lưu";
        btnSave.onclick = () => updateAmount(room.name, input.value);

        const btnPaid = document.createElement("button");
        btnPaid.textContent = "Đã thanh toán";
        btnPaid.onclick = () => markPaid(room.name);

        tdAction.appendChild(btnSave);
        tdAction.appendChild(btnPaid);
        tr.appendChild(tdAction);

        tbody.appendChild(tr);
      });
    }

    // Ghi số tiền vào Sheet
    async function updateAmount(room, amount) {
      await fetch(`${API_URL}?action=updateAmount&room=${encodeURIComponent(room)}&amount=${amount}`);
      loadRooms();
    }

    // Đánh dấu đã thanh toán
    async function markPaid(room) {
      await fetch(`${API_URL}?action=markPaid&room=${encodeURIComponent(room)}`);
      loadRooms();
    }

    // Tải dữ liệu ban đầu
    loadRooms();
    // Refresh mỗi 30s
    setInterval(loadRooms, 30000);
  </script>
</body>
</html>
