<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Nhân Viên - Karaoke</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #fffaf0; }
    h2 { color: #444; }
    .room { padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; }
    .paid { background: #d4edda; }
    button { margin-top: 5px; padding: 8px 12px; }
  </style>
</head>
<body>
  <h2>Danh sách phòng cần thanh toán</h2>
  <div id="list"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycby6P2_RMRn3Vly9KSoc-nJ4pi6UbTyXDvxUV6GFgGKQEAyN-44VBNbnCFeh5l1-txQQ/exec";

    async function loadRooms() {
      let res = await fetch(`${API_URL}?action=get`);
      let data = await res.json();
      let list = document.getElementById("list");
      list.innerHTML = "";

      data.forEach(r => {
        let div = document.createElement("div");
        div.className = "room " + (r.status === "paid" ? "paid" : "");
        div.innerHTML = `
          <b>Phòng:</b> ${r.room} <br>
          <b>Số tiền:</b> ${r.amount} <br>
          <b>Trạng thái:</b> ${r.status}
        `;
        if (r.status !== "paid") {
          let btn = document.createElement("button");
          btn.innerText = "✅ Đã thanh toán";
          btn.onclick = () => markPaid(r.room);
          div.appendChild(btn);
        }
        list.appendChild(div);
      });
    }

    async function markPaid(room) {
      await fetch(`${API_URL}?action=update&room=${encodeURIComponent(room)}&status=paid`);
      loadRooms();
    }

    loadRooms();
    setInterval(loadRooms, 5000); // refresh 5 giây 1 lần
  </script>
</body>
</html>
